<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="快捷链接 - 谭立状"/>
    <meta name="keywords" content="快捷链接, 谭立状, 齐鲁工业大学, 山东省计算中心, 国家超级计算济南中心"/>
    <meta name="author" content="Lizhuang Tan"/>
    
    <link rel="icon" href="img/logo.ico" type="image/x-icon">
    <title>快捷链接 - 谭立状</title>
    
    <!-- 字体 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@100..900&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.0/css/all.min.css">
    
    <style>
        html {
            overflow-x: hidden;
        }
        
        body {
            font-family: "Noto Sans SC", sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #f6f9fc 0%, #e9ecef 100%);
            min-height: 100vh;
            background-attachment: fixed;
            line-height: 1.4;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            width: calc(100% - 40px);
            margin: 0 auto;
            padding: 10px 20px 20px 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-height: 50vh;
            max-height: 90vh;
        }

        /* 搜索组合组件 */
        .search-group {
            position: fixed;
            bottom: 15px;
            right: 180px; /* 默认位置，当没有管理模式时 */
            z-index: 1000;
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
            padding: 2px;
            transition: all 0.3s ease;
            height: 40px; /* 与其他按钮高度保持一致 */
            box-sizing: border-box;
        }

        /* 当管理模式按钮显示时，搜索组件向左移动 */
        .search-group.with-management-mode {
            right: 320px; /* 为管理模式按钮让出空间 */
        }

        /* 关闭按钮样式 */
        .close-button {
            position: fixed;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #e9ecef;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1002;
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        }

        .close-button:hover {
            background: #f8f9fa;
            border-color: #dc3545;
            color: #dc3545;
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(220, 53, 69, 0.2);
        }

        .shortcut-settings-button {
            background: transparent;
            border: none;
            border-radius: 20px;
            padding: 6px 10px; /* 调整内边距适应40px容器高度 */
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 6px;
            height: 28px; /* 设置按钮内容高度 */
            width: 28px; /* 设置按钮宽度，保持正方形 */
        }

        .shortcut-settings-button:hover {
            background: rgba(0, 123, 255, 0.1);
            color: #007bff;
        }

        /* 快捷键设置模态框样式 */
        .shortcut-modal {
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .shortcut-info {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .sync-status {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 6px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sync-status.connected {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .sync-status.disconnected {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .sync-status i {
            font-size: 14px;
        }

        .shortcut-mode-selector {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .radio-option {
            display: flex;
            align-items: flex-start;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .radio-option:hover {
            border-color: #007bff;
            background: rgba(0, 123, 255, 0.05);
        }

        .radio-option input[type="radio"] {
            margin-right: 12px;
            margin-top: 2px;
        }

        .radio-option input[type="radio"]:checked + .radio-label {
            color: #007bff;
        }

        .radio-option:has(input[type="radio"]:checked) {
            border-color: #007bff;
            background: rgba(0, 123, 255, 0.1);
        }

        .radio-label {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .radio-label small {
            color: #6c757d;
            font-size: 12px;
        }

        .manual-settings {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: #fafafa;
        }

        .shortcut-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
        }

        .shortcut-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
        }

        .shortcut-item-info {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .shortcut-item-title {
            font-weight: 500;
            color: #333;
        }

        .shortcut-item-url {
            font-size: 12px;
            color: #6c757d;
        }

        .shortcut-key-input {
            width: 60px;
            text-align: center;
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
        }

        .shortcut-help {
            margin-top: 20px;
            padding: 15px;
            background: #e8f4fd;
            border: 1px solid #bee5eb;
            border-radius: 8px;
        }

        .shortcut-help h4 {
            margin: 0 0 10px 0;
            color: #0c5460;
        }

        .shortcut-help ul {
            margin: 0;
            padding-left: 20px;
        }

        .shortcut-help li {
            margin: 5px 0;
            color: #0c5460;
        }

        .shortcut-help kbd {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 3px;
            padding: 2px 6px;
            font-family: monospace;
            font-size: 12px;
        }

        .search-box {
            width: 200px;
            padding: 8px 15px; /* 调整内边距适应40px高度 */
            border: none;
            border-radius: 20px;
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
            background: transparent;
            flex: 1;
            height: 24px; /* 明确设置内容高度 */
            line-height: 24px;
        }

        .search-box:focus {
            background: rgba(0, 123, 255, 0.05);
        }

        .search-group:focus-within {
            box-shadow: 0 4px 20px rgba(9, 132, 227, 0.2);
            transform: translateY(-1px);
        }

        .search-box::placeholder {
            color: #6c757d;
            font-size: 13px;
        }

        /* GitHub认证和自定义功能样式 */
        .github-auth-button, .management-mode-toggle {
            position: fixed;
            bottom: 15px;
            background: #9b0d31;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 10px 16px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(155, 13, 49, 0.3);
            transition: all 0.3s ease;
            font-size: 13px;
            font-weight: 500;
            z-index: 1000;
            min-width: 110px;
            text-align: center;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
        }

        .github-auth-button {
            right: 15px;
        }

        .management-mode-toggle {
            right: 150px;
            background: #6f42c1;
            box-shadow: 0 4px 12px rgba(111, 66, 193, 0.3);
        }

        .github-auth-button:hover, .management-mode-toggle:hover {
            transform: translateY(-2px);
        }

        .github-auth-button:hover {
            background: #7a0a26;
            box-shadow: 0 6px 16px rgba(155, 13, 49, 0.4);
        }

        .management-mode-toggle:hover {
            background: #5a32a3;
            box-shadow: 0 6px 16px rgba(111, 66, 193, 0.4);
        }

        .github-auth-button.connected {
            background: #28a745;
        }

        .github-auth-button.connected:hover {
            background: #218838;
        }

        .management-mode-toggle.active {
            background: #dc3545;
        }

        .management-mode-toggle.active:hover {
            background: #c82333;
        }

        /* 弹窗样式 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .modal-content h3 {
            margin-top: 0;
            color: #2c3e50;
            font-size: 1.4rem;
        }

        .auth-steps {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .auth-steps ol {
            margin: 10px 0;
            padding-left: 20px;
        }

        .auth-steps li {
            margin: 8px 0;
            line-height: 1.4;
        }

        .modal-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            margin: 10px 0;
            box-sizing: border-box;
        }

        .modal-input:focus {
            border-color: #9b0d31;
            outline: none;
        }

        .modal-button {
            background: #9b0d31;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            margin: 5px;
            transition: background 0.3s ease;
        }

        .modal-button:hover {
            background: #7a0a26;
        }

        .modal-button.secondary {
            background: #6c757d;
        }

        .modal-button.secondary:hover {
            background: #5a6268;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 40px 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 3000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            cursor: pointer;
            max-width: 300px;
            word-wrap: break-word;
        }
        
        .notification::after {
            content: '×';
            position: absolute;
            top: 50%;
            right: 12px;
            transform: translateY(-50%);
            font-size: 18px;
            font-weight: bold;
            opacity: 0.7;
        }
        
        .notification:hover::after {
            opacity: 1;
        }

        .notification.success {
            background: #28a745;
        }

        .notification.error {
            background: #dc3545;
        }

        .notification.show {
            transform: translateX(0);
        }



        /* 高级管理功能样式 */
        .section-controls {
            display: none;
            align-items: center;
            gap: 8px;
            margin-left: auto;
            z-index: 100;
            position: relative;
        }

        .section.editing .section-controls {
            display: flex;
        }

        .section-control-btn {
            background: none;
            border: none;
            color: #6c757d;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            transition: all 0.3s ease;
            z-index: 101;
            position: relative;
        }

        .section-control-btn:hover {
            background: #f8f9fa;
            color: #9b0d31;
        }

        .section-control-btn.active {
            background: #9b0d31;
            color: white;
        }



        .section.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }

        .section.drag-over {
            border: 2px dashed #9b0d31;
            background: rgba(155, 13, 49, 0.1);
        }

        .link-card.dragging {
            opacity: 0.5;
            transform: scale(0.95) rotate(2deg);
            z-index: 1000;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .link-card.drag-over {
            border: 2px dashed #007bff;
            background: rgba(0, 123, 255, 0.1);
            transform: scale(1.02);
        }

        .link-card[draggable="true"] {
            cursor: grab;
        }

        .link-card[draggable="true"]:active {
            cursor: grabbing;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            position: relative;
            z-index: 50;
        }

        .visibility-toggle {
            opacity: 0.6;
            transition: opacity 0.3s ease;
        }

        .section.hidden {
            display: none;
        }

        /* 为隐藏的栏目显示一个简化的标题栏 */
        .section.hidden {
            display: block;
            opacity: 0.3;
            pointer-events: none;
            margin-bottom: 5px;
        }

        .section.hidden .links-grid {
            display: none;
        }

        .section.hidden .section-title {
            opacity: 0.5;
            font-size: 0.9rem;
        }

        .section.hidden .visibility-toggle {
            pointer-events: auto;
            opacity: 1;
        }

        .link-card.editing {
            position: relative;
            border: 2px dashed #6c757d;
            pointer-events: none; /* 禁用链接点击 */
        }

        .link-card.editing .link-edit-controls {
            pointer-events: auto; /* 恢复编辑按钮的点击 */
        }

        .link-edit-controls {
            position: absolute;
            top: 5px;
            right: 5px;
            display: none;
            gap: 4px;
            z-index: 102;
        }

        .link-card.editing .link-edit-controls {
            display: flex;
        }

        .link-edit-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 103;
            position: relative;
        }

        .link-edit-btn:hover {
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .link-edit-btn.edit {
            color: #007bff;
        }

        .link-edit-btn.delete {
            color: #dc3545;
        }



        .section {
            display: flex;
            flex-direction: column;
            padding: 6px 15px 15px 15px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
            margin-bottom: 0;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 500;
            color: #2c3e50;
            margin-bottom: 4px;
            padding-bottom: 2px;
            border-bottom: 2px solid #9b0d31;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title i {
            font-size: 1rem;
            color: #9b0d31;
        }

        .links-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 8px;
            padding-right: 5px;
        }



        .link-card {
            background: white;
            border-radius: 10px;
            padding: 10px 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
            text-decoration: none;
            color: inherit;
            border: 1px solid #e9ecef;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            height: 55px;
            box-sizing: border-box;
        }

        .link-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: #9b0d31;
            transition: width 0.3s ease;
        }

        .link-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            background: white;
        }

        .link-card:hover::before {
            width: 5px;
        }

        .link-icon {
            font-size: 1.3rem;
            color: #9b0d31;
            margin-right: 12px;
            flex-shrink: 0;
            width: 20px;
            text-align: center;
        }

        .link-content {
            flex: 1;
            min-width: 0;
        }

        .link-title {
            font-size: 0.9rem;
            font-weight: 500;
            color: #2c3e50;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .link-url {
            font-size: 0.75rem;
            color: #3498db;
            opacity: 0.8;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }



        /* 快捷键提示 */
        .shortcut-hint {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #9b0d31;
            color: white;
            font-size: 0.7rem;
            font-weight: 600;
            padding: 3px 7px;
            border-radius: 12px;
            opacity: 0.8;
            transition: all 0.3s ease;
            pointer-events: none;
            min-width: 16px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .link-card:hover .shortcut-hint {
            opacity: 1;
            transform: scale(1.1);
        }



        /* 响应式设计 */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                gap: 20px;
                min-height: 40vh;
            }

            .search-container {
                top: 15px;
                right: 15px;
            }

            .search-box {
                width: 200px;
                font-size: 13px;
                padding: 6px 12px;
            }

            .search-box:focus {
                width: 220px;
            }
            
            .links-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .link-card {
                padding: 10px 12px;
                height: 55px;
            }
            
            .section-title {
                font-size: 1rem;
                margin-bottom: 10px;
            }

            .link-title {
                font-size: 0.85rem;
            }

            .link-url {
                font-size: 0.7rem;
            }
        }

        @media (min-width: 1200px) {
            .links-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
        }

        @media (min-width: 1600px) {
            .links-grid {
                grid-template-columns: repeat(5, 1fr);
            }
        }

        /* 动画效果 */
        .section {
            opacity: 0;
            transform: translateY(15px);
            animation: fadeInUp 0.4s ease forwards;
        }

        .section:nth-child(1) { animation-delay: 0.05s; }
        .section:nth-child(2) { animation-delay: 0.1s; }
        .section:nth-child(3) { animation-delay: 0.15s; }
        .section:nth-child(4) { animation-delay: 0.2s; }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .container {
                width: calc(100% - 30px);
                padding: 8px 15px 15px 15px;
                gap: 6px;
            }
            
                                                            .search-group {
            position: fixed;
                bottom: 70px;
                left: 50%;
                right: auto;
                transform: translateX(-50%);
                padding: 2px;
                height: 36px; /* 移动端稍微减小高度 */
            }

            /* 移动端管理模式时的位置调整 */
            .search-group.with-management-mode {
                right: auto; /* 移动端继续居中显示 */
                left: 50%;
                transform: translateX(-50%);
            }
            
            .search-box {
                width: 150px;
                padding: 6px 12px;
                font-size: 13px;
                height: 20px;
                line-height: 20px;
            }

            .shortcut-settings-button {
                padding: 4px 6px;
                font-size: 12px;
                margin-right: 4px;
                height: 24px;
                width: 24px;
            }

            .close-button {
                top: 12px;
                right: 12px;
                width: 36px;
                height: 36px;
                font-size: 16px;
            }
            
            .section {
                padding: 5px 12px 12px 12px;
                margin-bottom: 0;
            }
            
            .section-title {
                margin-bottom: 3px;
                padding-bottom: 1px;
            }
            
            .links-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                gap: 6px;
            }
            
            .link-card {
                height: 50px;
                padding: 8px 10px;
            }
            
            .github-auth-button, .management-mode-toggle {
                bottom: 12px;
                padding: 8px 14px;
                font-size: 12px;
                min-width: 90px;
                height: 36px;
            }
            
            .github-auth-button {
                right: 12px;
            }
            
            .management-mode-toggle {
                right: 115px;
            }
        }

    </style>
</head>
<body>
    <!-- 关闭按钮 -->
    <button class="close-button" onclick="returnToHomepage()" title="返回主页">
        <i class="fas fa-times"></i>
    </button>

    <div class="container">
        <!-- 搜索栏和快捷键设置组合 -->
        <div class="search-group">
            <button class="shortcut-settings-button" onclick="openShortcutSettings()" title="快捷键设置">
                <i class="fas fa-keyboard"></i>
            </button>
            <input type="text" class="search-box" placeholder="搜索链接..." onkeyup="searchLinks()">
        </div>
        <!-- 学校栏目 -->
        <div class="section" data-section-id="school" data-section-type="built-in">
            <div class="section-header">
            <h2 class="section-title">
                    <i class="fas fa-university"></i>学校
            </h2>
                <div class="section-controls">
                    <button class="section-control-btn visibility-toggle" onclick="toggleSectionVisibility('school')" title="显示/隐藏栏目">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="section-control-btn" onclick="openAddLinkModal('school')" title="添加链接">
                        <i class="fas fa-plus"></i>
                    </button>
                    <button class="section-control-btn" onclick="toggleSectionEdit('school')" title="编辑模式">
                        <i class="fas fa-edit"></i>
                    </button>
                </div>
            </div>
            <div class="links-grid">
                <a href="https://www.qlu.edu.cn/" class="link-card" target="_blank" data-shortcut="1">
                    <i class="fas fa-graduation-cap link-icon"></i>
                    <div class="link-content">
                    <div class="link-title">齐鲁工业大学</div>
                    <div class="link-url">www.qlu.edu.cn</div>
                    </div>
                    <div class="shortcut-hint">1</div>
                </a>
                
                <a href="http://www.scsc.cn/" class="link-card" target="_blank">
                    <i class="fas fa-server link-icon"></i>
                    <div class="link-content">
                    <div class="link-title">山东省计算中心</div>
                        <div class="link-url">www.scsc.cn</div>
                    </div>
                </a>

                
            </div>
        </div>

        <!-- 科研栏目 -->
        <div class="section" data-section-id="research" data-section-type="built-in">
            <div class="section-header">
            <h2 class="section-title">
                    <i class="fas fa-flask"></i>科研
            </h2>
                <div class="section-controls">
                    <button class="section-control-btn visibility-toggle" onclick="toggleSectionVisibility('research')" title="显示/隐藏栏目">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="section-control-btn" onclick="openAddLinkModal('research')" title="添加链接">
                        <i class="fas fa-plus"></i>
                    </button>
                    <button class="section-control-btn" onclick="toggleSectionEdit('research')" title="编辑模式">
                        <i class="fas fa-edit"></i>
                    </button>
                </div>
            </div>
            <div class="links-grid">
                <a href="https://www.google.com/" class="link-card" target="_blank">
                    <i class="fab fa-google link-icon"></i>
                    <div class="link-content">
                        <div class="link-title">谷歌搜索</div>
                        <div class="link-url">google.com</div>
                    </div>
                </a>

                <a href="https://www.baidu.com/" class="link-card" target="_blank">
                    <i class="fas fa-search link-icon"></i>
                    <div class="link-content">
                        <div class="link-title">百度搜索</div>
                        <div class="link-url">baidu.com</div>
                    </div>
                </a>



                <a href="https://translate.google.com/" class="link-card" target="_blank">
                    <i class="fas fa-language link-icon"></i>
                    <div class="link-content">
                        <div class="link-title">谷歌翻译</div>
                        <div class="link-url">translate.google.com</div>
                    </div>
                </a>

                <a href="https://www.cnki.net/" class="link-card" target="_blank">
                    <i class="fas fa-book link-icon"></i>
                    <div class="link-content">
                        <div class="link-title">中国知网</div>
                        <div class="link-url">cnki.net</div>
                    </div>
                </a>

                <a href="https://scholar.google.com/?hl=zh-CN" class="link-card" target="_blank">
                    <i class="fas fa-graduation-cap link-icon"></i>
                    <div class="link-content">
                    <div class="link-title">Google Scholar</div>
                    <div class="link-url">scholar.google.com</div>
                    </div>
                </a>
                
                <a href="https://ieeexplore.ieee.org/" class="link-card" target="_blank">
                    <i class="fas fa-microchip link-icon"></i>
                    <div class="link-content">
                    <div class="link-title">IEEE</div>
                        <div class="link-url">ieeexplore.ieee.org</div>
                    </div>
                </a>

                <a href="https://www.acm.org/" class="link-card" target="_blank">
                    <i class="fas fa-code link-icon"></i>
                    <div class="link-content">
                    <div class="link-title">ACM</div>
                    <div class="link-url">acm.org</div>
                    </div>
                </a>

                <a href="https://arxiv.org/" class="link-card" target="_blank">
                    <i class="fas fa-file-alt link-icon"></i>
                    <div class="link-content">
                    <div class="link-title">arXiv</div>
                    <div class="link-url">arxiv.org</div>
                    </div>
                </a>

                <a href="https://www.researchgate.net/" class="link-card" target="_blank">
                    <i class="fas fa-users link-icon"></i>
                    <div class="link-content">
                    <div class="link-title">ResearchGate</div>
                    <div class="link-url">researchgate.net</div>
                    </div>
                </a>

                <a href="https://orcid.org/" class="link-card" target="_blank">
                    <i class="fas fa-id-card link-icon"></i>
                    <div class="link-content">
                    <div class="link-title">ORCID</div>
                    <div class="link-url">orcid.org</div>
                    </div>
                </a>

                <a href="https://webofscience.com/" class="link-card" target="_blank">
                    <i class="fas fa-globe link-icon"></i>
                    <div class="link-content">
                        <div class="link-title">Web of Science</div>
                        <div class="link-url">webofscience.com</div>
            </div>
                </a>


                <a href="https://www.overleaf.com/" class="link-card" target="_blank">
                    <i class="fas fa-edit link-icon"></i>
                    <div class="link-content">
                        <div class="link-title">Overleaf</div>
                        <div class="link-url">overleaf.com</div>
                    </div>
                </a>

                <a href="https://ieee.atyponrex.com/submission/dashboard" class="link-card" target="_blank">
                    <i class="fas fa-upload link-icon"></i>
                    <div class="link-content">
                        <div class="link-title">IEEE投稿系统</div>
                        <div class="link-url">ieee.atyponrex.com</div>
                    </div>
                </a>

                <a href="https://www.letpub.com.cn/index.php?page=journalapp" class="link-card" target="_blank">
                    <i class="fas fa-search-plus link-icon"></i>
                    <div class="link-content">
                        <div class="link-title">LetPub期刊查询</div>
                        <div class="link-url">letpub.com.cn</div>
                    </div>
                </a>

                <a href="https://cpquery.cponline.cnipa.gov.cn/chinesepatent/index" class="link-card" target="_blank">
                    <i class="fas fa-certificate link-icon"></i>
                    <div class="link-content">
                        <div class="link-title">中国专利查询</div>
                        <div class="link-url">cpquery.cponline.cnipa.gov.cn</div>
                    </div>
                </a>
            </div>
        </div>

        <!-- 个人栏目 -->
        <div class="section" data-section-id="personal" data-section-type="built-in">
            <div class="section-header">
            <h2 class="section-title">
                    <i class="fas fa-user"></i>个人
            </h2>
                <div class="section-controls">
                    <button class="section-control-btn visibility-toggle" onclick="toggleSectionVisibility('personal')" title="显示/隐藏栏目">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="section-control-btn" onclick="openAddLinkModal('personal')" title="添加链接">
                        <i class="fas fa-plus"></i>
                    </button>
                    <button class="section-control-btn" onclick="toggleSectionEdit('personal')" title="编辑模式">
                        <i class="fas fa-edit"></i>
                    </button>
                </div>
            </div>
            <div class="links-grid">
                

                <a href="https://github.com/lzhtan" class="link-card" target="_blank">
                    <i class="fab fa-github link-icon"></i>
                    <div class="link-content">
                    <div class="link-title">GitHub</div>
                    <div class="link-url">github.com/lzhtan</div>
                    </div>
                </a>

                <a href="https://mail.qlu.edu.cn" class="link-card" target="_blank">
                    <i class="fas fa-envelope link-icon"></i>
                    <div class="link-content">
                        <div class="link-title">学校邮箱</div>
                        <div class="link-url">mail.qlu.edu.cn</div>
                    </div>
                </a>

                <a href="https://mail.sdas.org" class="link-card" target="_blank">
                    <i class="fas fa-envelope-open link-icon"></i>
                    <div class="link-content">
                        <div class="link-title">中心邮箱</div>
                        <div class="link-url">mail.sdas.org</div>
                    </div>
                </a>



                <a href="https://www.linkedin.com/" class="link-card" target="_blank">
                    <i class="fab fa-linkedin link-icon"></i>
                    <div class="link-content">
                    <div class="link-title">LinkedIn</div>
                    <div class="link-url">linkedin.com</div>
                    </div>
                </a>
            </div>
        </div>

        <!-- 链接栏目 -->
        <div class="section" data-section-id="links" data-section-type="built-in">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-link"></i>链接
                </h2>
                <div class="section-controls">
                    <button class="section-control-btn visibility-toggle" onclick="toggleSectionVisibility('links')" title="显示/隐藏栏目">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="section-control-btn" onclick="openAddLinkModal('links')" title="添加链接">
                        <i class="fas fa-plus"></i>
                    </button>
                    <button class="section-control-btn" onclick="toggleSectionEdit('links')" title="编辑模式">
                        <i class="fas fa-edit"></i>
                    </button>
                </div>
            </div>
            <div class="links-grid">
                <a href="https://chatgpt.com/" class="link-card" target="_blank">
                    <i class="fas fa-robot link-icon"></i>
                    <div class="link-content">
                        <div class="link-title">ChatGPT</div>
                        <div class="link-url">chatgpt.com</div>
                    </div>
                </a>

                <a href="https://www.zhihu.com/" class="link-card" target="_blank">
                    <i class="fab fa-zhihu link-icon"></i>
                    <div class="link-content">
                        <div class="link-title">知乎</div>
                        <div class="link-url">zhihu.com</div>
            </div>
                </a>

                <a href="https://vmeeting.io/" class="link-card" target="_blank">
                    <i class="fas fa-video link-icon"></i>
                    <div class="link-content">
                        <div class="link-title">线上会议</div>
                        <div class="link-url">vmeeting.io</div>
                    </div>
                </a>
        </div>
        </div>
    </div>

    <!-- GitHub认证按钮 -->
    <button class="github-auth-button" id="githubAuthButton" onclick="openGitHubAuthModal()">
        <i class="fab fa-github"></i> 连接GitHub
    </button>



    <!-- 管理模式切换按钮 -->
    <button class="management-mode-toggle" id="managementModeToggle" onclick="testToggleManagementMode()" style="display: block;">
        <i class="fas fa-cog"></i> 管理模式
    </button>

    <!-- GitHub认证弹窗 -->
    <div class="modal-overlay" id="githubAuthModal">
        <div class="modal-content">
            <h3><i class="fab fa-github"></i> 连接GitHub账户</h3>
            <p>为了保存和同步您的自定义链接配置，需要连接GitHub账户。</p>
            
            <div class="auth-steps">
                <h4>设置步骤：</h4>
                <ol>
                    <li>访问 <a href="https://github.com/settings/tokens" target="_blank">GitHub Settings → Developer settings → Personal access tokens → Tokens (classic)</a></li>
                    <li>点击 "Generate new token (classic)"</li>
                    <li>勾选 <strong>"gist"</strong> 权限</li>
                    <li>点击生成并复制Token</li>
                    <li>将Token粘贴到下方输入框</li>
                </ol>
            </div>
            
            <input type="password" class="modal-input" id="githubToken" placeholder="粘贴您的GitHub Personal Access Token">
            <div>
                <button class="modal-button" onclick="setupGitHubAuth()">连接GitHub</button>
                <button class="modal-button secondary" onclick="closeModal('githubAuthModal')">取消</button>
            </div>
        </div>
    </div>

    <!-- 快捷键设置模态框 -->
    <div class="modal-overlay" id="shortcutSettingsModal">
        <div class="modal-content shortcut-modal">
            <h3><i class="fas fa-keyboard"></i> 快捷键设置</h3>
            
            <div class="shortcut-info">
                <div class="sync-status" id="shortcutSyncStatus">
                    <!-- 动态显示同步状态 -->
                </div>
                
                <div class="shortcut-mode-selector">
                    <label class="radio-option">
                        <input type="radio" name="shortcutMode" value="auto" checked onchange="changeShortcutMode()">
                        <span class="radio-label">
                            <strong>自动分配（推荐）</strong>
                            <small>按链接在页面中的顺序自动分配1-9</small>
                        </span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="shortcutMode" value="manual" onchange="changeShortcutMode()">
                        <span class="radio-label">
                            <strong>手动设置</strong>
                            <small>为每个链接单独设置快捷键</small>
                        </span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="shortcutMode" value="disabled" onchange="changeShortcutMode()">
                        <span class="radio-label">
                            <strong>禁用快捷键</strong>
                            <small>完全关闭数字键快捷键功能</small>
                        </span>
                    </label>
                </div>
            </div>
            
            <div id="manualShortcutSettings" class="manual-settings" style="display: none;">
                <h4>手动快捷键设置</h4>
                <div class="shortcut-list" id="shortcutList">
                    <!-- 动态生成的快捷键设置项 -->
                </div>
            </div>

            <div class="shortcut-help">
                <h4>快捷键说明</h4>
                <ul>
                    <li><kbd>1-9</kbd>: 访问对应链接</li>
                    <li><kbd>ESC</kbd>: 清空搜索框</li>
                    <li><kbd>Ctrl+K</kbd>: 聚焦搜索框</li>
                </ul>
            </div>
            
            <div>
                <button class="modal-button" onclick="saveShortcutSettings()">保存设置</button>
                <button class="modal-button secondary" onclick="closeShortcutSettings()">取消</button>
            </div>
        </div>
    </div>

    <!-- 添加链接弹窗 -->
    <div class="modal-overlay" id="addLinkModal">
        <div class="modal-content">
            <h3><i class="fas fa-link"></i> 添加链接</h3>
            <form onsubmit="addCustomLink(event)">
                <input type="hidden" id="targetSectionId">
                <input type="text" class="modal-input" id="linkTitle" placeholder="链接标题" required>
                <input type="url" class="modal-input" id="linkUrl" placeholder="链接地址 (https://...)" required>
                <input type="text" class="modal-input" id="linkIcon" placeholder="图标类名（如：fas fa-globe）" value="fas fa-link">
                <div>
                    <button type="submit" class="modal-button">添加链接</button>
                    <button type="button" class="modal-button secondary" onclick="closeModal('addLinkModal')">取消</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 编辑链接弹窗 -->
    <div class="modal-overlay" id="editLinkModal">
        <div class="modal-content">
            <h3><i class="fas fa-edit"></i> 编辑链接</h3>
            <form onsubmit="updateLink(event)">
                <input type="hidden" id="editLinkId">
                <input type="hidden" id="editSectionId">
                <input type="text" class="modal-input" id="editLinkTitle" placeholder="链接标题" required>
                <input type="url" class="modal-input" id="editLinkUrl" placeholder="链接地址 (https://...)" required>
                <input type="text" class="modal-input" id="editLinkIcon" placeholder="图标类名（如：fas fa-globe）">
                <div>
                    <button type="submit" class="modal-button">保存更改</button>
                    <button type="button" class="modal-button secondary" onclick="closeModal('editLinkModal')">取消</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 通知提示 -->
    <div class="notification" id="notification"></div>

    <script>
        // 中文拼音映射表
        const pinyinMap = {
            '齐鲁工业大学': ['qilu', 'ql', 'qilugongye', 'qilugongyedaxue', 'qlgy', 'qldx'],
            '山东省计算中心': ['shandong', 'sd', 'shandongsheng', 'jisuan', 'js', 'zhongxin', 'zx', 'sdjszx'],
            '学校': ['xuexiao', 'xx'],
            '中心': ['zhongxin', 'zx'],
            '科研': ['keyan', 'ky'],
            '个人': ['geren', 'gr'],
            '链接': ['lianjie', 'lj'],
            '谷歌': ['guge', 'google', 'gg'],
            '百度': ['baidu', 'bd'],
            '翻译': ['fanyi', 'fy'],
            '知网': ['zhiwang', 'zw'],
            '中国知网': ['zhongguozhiwang', 'zgzw', 'cnki'],
            '科技厅': ['kejiting', 'kjt'],
            '自然基金委': ['ziranjiijinwei', 'zrjjw', 'nsfc'],
            '重点研发计划': ['zhongdianyankaijihua', 'zdyfkjh'],
            '线上会议': ['xianshanghuiyi', 'xshy'],
            '邮箱': ['youxiang', 'yx'],
            '主页': ['zhuye', 'zy'],
            'Overleaf': ['overleaf', 'latex', 'ol'],
            '知乎': ['zhihu', 'zh'],
            'IEEE投稿系统': ['ieeeshouge', 'ieee', 'tougao', 'tg', 'submission'],
            'LetPub期刊查询': ['letpub', 'qikan', 'qk', 'chaxun', 'cx', 'sci'],
            '中国专利查询': ['zhongguozhuanli', 'zgzl', 'zhuanli', 'zl', 'patent', 'cnipa']
        };

        // GitHub Gist存储管理器
        class GitHubGistStorage {
            constructor() {
                this.token = localStorage.getItem('github_token');
                this.gistId = localStorage.getItem('gist_id');
                this.username = localStorage.getItem('github_username');
            }

            // 设置GitHub Token
            async setToken(token) {
                this.token = token;
                
                try {
                    // 验证token并获取用户信息
                    const response = await fetch('https://api.github.com/user', {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });

                    if (response.ok) {
                        const user = await response.json();
                        this.username = user.login;
                        
                        localStorage.setItem('github_token', token);
                        localStorage.setItem('github_username', this.username);
                        
                        // 尝试查找现有的配置Gist
                        await this.findOrCreateConfigGist();
                        
                        return true;
                    } else {
                        throw new Error('Token验证失败');
                    }
                } catch (error) {
                    console.error('GitHub认证失败:', error);
                    return false;
                }
            }

            // 查找或创建配置Gist
            async findOrCreateConfigGist() {
                if (!this.token) return;
                
                console.log('查找现有的配置Gist...');
                
                try {
                    // 获取用户的所有Gists
                    const response = await fetch('https://api.github.com/gists', {
                        headers: {
                            'Authorization': `token ${this.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (response.ok) {
                        const gists = await response.json();
                        console.log('找到Gists数量:', gists.length);
                        
                        // 查找包含配置文件的Gist
                        const configGist = gists.find(gist => 
                            gist.files && 
                            gist.files['custom-links-config.json'] &&
                            gist.description && 
                            gist.description.includes('快捷链接自定义配置')
                        );
                        
                        if (configGist) {
                            console.log('找到现有配置Gist:', configGist.id);
                            this.gistId = configGist.id;
                            localStorage.setItem('gist_id', this.gistId);
                        } else {
                            console.log('没有找到现有配置Gist，将在首次保存时创建');
                            // 不需要立即创建，保存时会自动创建
                        }
                    } else {
                        console.warn('获取Gists列表失败:', response.status);
                    }
                } catch (error) {
                    console.error('查找配置Gist失败:', error);
                    // 不阻止后续流程，保存时会创建新的
                }
            }

            // 保存配置到Gist
            async saveConfig(config) {
                console.log('=== saveConfig 开始 ===');
                console.log('Token存在:', !!this.token);
                console.log('GistId:', this.gistId);
                console.log('配置数据:', config);
                
                if (!this.token) {
                    throw new Error('请先连接GitHub账户');
                }

                const gistData = {
                    description: '快捷链接自定义配置 - ' + window.location.hostname,
                    public: false,
                    files: {
                        'custom-links-config.json': {
                            content: JSON.stringify({
                                version: '1.0',
                                timestamp: new Date().toISOString(),
                                hostname: window.location.hostname,
                                config: config
                            }, null, 2)
                        }
                    }
                };

                let url = 'https://api.github.com/gists';
                let method = 'POST';

                // 如果已有gist，则更新
                if (this.gistId) {
                    url = `https://api.github.com/gists/${this.gistId}`;
                    method = 'PATCH';
                    console.log('更新现有Gist:', this.gistId);
                } else {
                    console.log('创建新Gist');
                }

                console.log('请求URL:', url);
                console.log('请求方法:', method);
                console.log('请求数据:', JSON.stringify(gistData, null, 2));

                try {
                    const response = await fetch(url, {
                        method,
                        headers: {
                            'Authorization': `token ${this.token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(gistData)
                    });

                    console.log('响应状态:', response.status);
                    console.log('响应OK:', response.ok);

                    if (response.ok) {
                        const result = await response.json();
                        console.log('保存成功，结果:', result);
                        this.gistId = result.id;
                        localStorage.setItem('gist_id', this.gistId);
                        console.log('新的GistId已保存:', this.gistId);
                        return result;
                    } else {
                        const errorText = await response.text();
                        console.error('GitHub API错误响应:', errorText);
                        let error;
                        try {
                            error = JSON.parse(errorText);
                        } catch {
                            error = { message: errorText };
                        }
                        throw new Error(`GitHub API错误 (${response.status}): ${error.message || errorText}`);
                    }
                } catch (fetchError) {
                    console.error('Fetch请求失败:', fetchError);
                    throw new Error(`网络请求失败: ${fetchError.message}`);
                }
            }

            // 从Gist加载配置
            async loadConfig() {
                console.log('GitHub存储加载配置，gistId:', this.gistId, 'token存在:', !!this.token); // 调试日志
                if (!this.gistId || !this.token) {
                    console.log('缺少gistId或token，返回null'); // 调试日志
                    return null;
                }

                try {
                    console.log('开始从GitHub Gist加载配置...'); // 调试日志
                    const response = await fetch(`https://api.github.com/gists/${this.gistId}`, {
                        headers: {
                            'Authorization': `token ${this.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });

                    if (response.ok) {
                        const gist = await response.json();
                        console.log('GitHub Gist响应:', gist); // 调试日志
                        const file = gist.files['custom-links-config.json'];
                        if (file) {
                            const data = JSON.parse(file.content);
                            console.log('解析的配置数据:', data); // 调试日志
                            return data.config || [];
                        } else {
                            console.log('Gist中没有找到配置文件'); // 调试日志
                        }
                    } else {
                        console.log('GitHub API响应失败:', response.status, response.statusText); // 调试日志
                    }
                } catch (error) {
                    console.error('加载配置失败:', error);
                }
                
                return null;
            }

            // 断开连接
            disconnect() {
                localStorage.removeItem('github_token');
                localStorage.removeItem('gist_id');
                localStorage.removeItem('github_username');
                this.token = null;
                this.gistId = null;
                this.username = null;
            }

            // 检查是否已连接
            isConnected() {
                return !!this.token;
            }
        }

        // 高级链接管理器（扩展版）
        class AdvancedLinksManager {
            constructor() {
                this.githubStorage = new GitHubGistStorage();
                this.builtInSections = {};
                this.hiddenSections = new Set();
                this.sectionOrder = ['school', 'research', 'personal', 'links'];
                this.isManagementMode = false;
                this.init();
            }

            async init() {
                // 初始化内置栏目数据
                this.initBuiltInSections();
                
                // 更新UI状态
                this.updateAuthButton();
                
                // 如果已连接GitHub，尝试加载配置
                if (this.githubStorage.isConnected()) {
                    await this.loadFromGitHub();
                }
            }

            // 初始化内置栏目数据结构
            initBuiltInSections() {
                const sections = document.querySelectorAll('[data-section-type="built-in"]');
                sections.forEach(section => {
                    const sectionId = section.dataset.sectionId;
                    this.builtInSections[sectionId] = {
                        id: sectionId,
                        element: section,
                        links: []
                    };
                });
            }

            // 更新认证按钮状态
            updateAuthButton() {
                const button = document.getElementById('githubAuthButton');
                const managementButton = document.getElementById('managementModeToggle');
                const searchGroup = document.querySelector('.search-group');
                
                console.log('updateAuthButton 被调用');
                console.log('GitHub连接状态:', this.githubStorage.isConnected());
                console.log('管理按钮元素:', managementButton);
                
                if (this.githubStorage.isConnected()) {
                    button.innerHTML = `<i class="fab fa-github"></i> ${this.githubStorage.username}`;
                    button.className = 'github-auth-button connected';
                    button.onclick = () => this.showUserMenu();
                    managementButton.style.display = 'block';
                    
                    // 调整搜索组件位置，为管理模式按钮让出空间
                    if (searchGroup) {
                        searchGroup.classList.add('with-management-mode');
                    }
                    
                    console.log('显示管理按钮，搜索组件向左移动');
                } else {
                    button.innerHTML = '<i class="fab fa-github"></i> 连接GitHub';
                    button.className = 'github-auth-button';
                    button.onclick = openGitHubAuthModal;
                    managementButton.style.display = 'none';
                    
                    // 恢复搜索组件的原始位置
                    if (searchGroup) {
                        searchGroup.classList.remove('with-management-mode');
                    }
                    
                    console.log('隐藏管理按钮，搜索组件恢复原位');
                    // 如果断开连接时正在管理模式，退出管理模式
                    if (this.isManagementMode) {
                        toggleManagementMode();
                    }
                }
            }



            // 添加链接到内置栏目
            addLinkToSection(sectionId, title, url, icon) {
                this.addLinkToBuiltInSection(sectionId, title, url, icon, true);
            }

            // 添加链接到内置栏目
            addLinkToBuiltInSection(sectionId, title, url, icon, shouldSave = false) {
                const section = document.querySelector(`[data-section-id="${sectionId}"] .links-grid`);
                if (section) {
                    const linkCard = document.createElement('a');
                    linkCard.href = url;
                    linkCard.className = 'link-card';
                    linkCard.target = '_blank';
                    
                    linkCard.innerHTML = `
                        <i class="${icon} link-icon"></i>
                        <div class="link-content">
                            <div class="link-title">${title}</div>
                            <div class="link-url">${new URL(url).hostname}</div>
                        </div>
                    `;
                    
                    // 标记为自定义添加的链接
                    linkCard.setAttribute('data-custom', 'true');
                    console.log(`添加自定义链接到 ${sectionId}:`, title, shouldSave ? '(保存到GitHub)' : '(仅恢复)'); // 调试日志
                    
                    section.appendChild(linkCard);
                    
                    // 如果在管理模式下，为新链接启用拖拽
                    if (this.isManagementMode) {
                        linkCard.draggable = true;
                        linkCard.addEventListener('dragstart', handleLinkDragStart);
                        linkCard.addEventListener('dragover', handleLinkDragOver);
                        linkCard.addEventListener('drop', handleLinkDrop);
                        linkCard.addEventListener('dragend', handleLinkDragEnd);
                    }
                    
                    // 只有在用户主动添加时才保存
                    if (shouldSave) {
                        this.saveToGitHub(true);
                    }
                    
                    // 更新快捷键分配
                    refreshShortcuts();
                }
            }



            // 保存完整配置到GitHub
            async saveToGitHub(showSuccess = false) {
                if (!this.githubStorage.isConnected()) {
                    if (showSuccess) {
                        showNotification('请先连接GitHub账户', 'error');
                    }
                    return;
                }
                
                try {
                    const fullConfig = this.getFullConfig();
                    console.log('保存配置到GitHub:', JSON.stringify(fullConfig, null, 2)); // 调试日志
                    const result = await this.githubStorage.saveConfig(fullConfig);
                    console.log('GitHub保存结果:', result); // 调试日志
                    if (showSuccess) {
                        showNotification('配置已同步到GitHub', 'success');
                    }
                } catch (error) {
                    console.error('保存配置失败:', error); // 调试日志
                    showNotification('同步失败: ' + error.message, 'error');
                }
            }

            // 获取完整配置（包括内置栏目修改、隐藏状态等）
            getFullConfig() {
                const config = {
                    hiddenSections: Array.from(this.hiddenSections),
                    builtInAdditions: {},
                    builtInDeletions: {},
                    builtInModifications: {},
                    sectionOrder: this.getCurrentSectionOrder()
                };

                // 收集内置栏目的所有链接状态
                Object.keys(this.builtInSections).forEach(sectionId => {
                    const sectionElement = document.querySelector(`[data-section-id="${sectionId}"] .links-grid`);
                    if (sectionElement) {
                        const addedLinks = [];
                        const modifiedLinks = [];
                        const deletedLinks = [];
                        
                        // 获取当前显示的所有链接
                        const currentLinks = [];
                        const linkCards = sectionElement.querySelectorAll('.link-card');
                        console.log(`栏目 ${sectionId} 中找到 ${linkCards.length} 个链接`); // 调试日志
                        
                        linkCards.forEach((card, index) => {
                            const linkData = {
                                title: card.querySelector('.link-title').textContent,
                                url: card.href,
                                icon: card.querySelector('.link-icon').className,
                                isCustom: card.hasAttribute('data-custom'),
                                isModified: card.hasAttribute('data-modified'),
                                originalIndex: card.hasAttribute('data-original-index') ? 
                                    parseInt(card.getAttribute('data-original-index')) : -1
                            };
                            currentLinks.push(linkData);
                            
                            if (linkData.isCustom) {
                                console.log(`找到自定义链接:`, linkData); // 调试日志
                                addedLinks.push({
                                    title: linkData.title,
                                    url: linkData.url,
                                    icon: linkData.icon
                                });
                            } else if (linkData.isModified) {
                                console.log(`找到修改过的链接:`, linkData); // 调试日志
                                modifiedLinks.push({
                                    title: linkData.title,
                                    url: linkData.url,
                                    icon: linkData.icon,
                                    originalIndex: linkData.originalIndex
                                });
                            }
                        });
                        
                        // 保存新增的链接
                        if (addedLinks.length > 0) {
                            config.builtInAdditions[sectionId] = addedLinks;
                        }
                        
                        // 保存修改过的链接
                        if (modifiedLinks.length > 0) {
                            config.builtInModifications[sectionId] = config.builtInModifications[sectionId] || {};
                            config.builtInModifications[sectionId].modified = modifiedLinks;
                        }
                        
                        // 记录当前所有链接（用于完整状态恢复）
                        config.builtInModifications[sectionId] = currentLinks.map(link => ({
                            title: link.title,
                            url: link.url,
                            icon: link.icon,
                            isCustom: link.isCustom,
                            isModified: link.isModified
                        }));
                    }
                });

                return config;
            }

            // 获取当前栏目顺序
            getCurrentSectionOrder() {
                const sections = document.querySelectorAll('.section[data-section-id]');
                return Array.from(sections).map(section => section.dataset.sectionId);
            }

            // 从GitHub加载完整配置
            async loadFromGitHub() {
                try {
                    const config = await this.githubStorage.loadConfig();
                    console.log('从GitHub加载的配置:', config); // 调试日志
                    if (config) {
                        // 向后兼容：如果是旧格式（数组），忽略
                        if (!Array.isArray(config)) {
                            // 新格式的完整配置
                            this.hiddenSections = new Set(config.hiddenSections || []);
                            
                            // 应用隐藏状态
                            this.applyHiddenStates();
                            
                            // 恢复完整的链接状态
                            if (config.builtInModifications) {
                                console.log('恢复内置栏目修改:', config.builtInModifications); // 调试日志
                                this.restoreBuiltInModifications(config.builtInModifications);
                            } else if (config.builtInAdditions) {
                                // 向后兼容旧配置格式
                                console.log('恢复内置栏目添加:', config.builtInAdditions); // 调试日志
                                this.restoreBuiltInAdditions(config.builtInAdditions);
                            }
                            
                            // 应用栏目顺序
                            if (config.sectionOrder) {
                                this.applySectionOrder(config.sectionOrder);
                            }

                            // 加载快捷键设置
                            loadShortcutSettingsFromGitHub(config);
                        }
                        
                        showNotification('已从GitHub加载配置', 'success');
                    } else {
                        console.log('没有找到保存的配置'); // 调试日志
                    }
                } catch (error) {
                    console.error('加载配置失败:', error); // 调试日志
                    showNotification('加载配置失败: ' + error.message, 'error');
                }
            }

            // 应用隐藏状态
            applyHiddenStates() {
                this.hiddenSections.forEach(sectionId => {
                    const section = document.querySelector(`[data-section-id="${sectionId}"]`);
                    if (section) {
                        section.classList.add('hidden');
                        const eyeIcon = section.querySelector('.visibility-toggle i');
                        if (eyeIcon) {
                            eyeIcon.className = 'fas fa-eye-slash';
                        }
                    }
                });
            }

            // 恢复完整的链接修改状态
            restoreBuiltInModifications(builtInModifications) {
                console.log('开始恢复完整链接状态...');
                
                Object.keys(builtInModifications).forEach(sectionId => {
                    const links = builtInModifications[sectionId];
                    const section = document.querySelector(`[data-section-id="${sectionId}"] .links-grid`);
                    
                    if (section && Array.isArray(links)) {
                        console.log(`恢复栏目 ${sectionId} 的链接，目标数量: ${links.length}`);
                        
                        // 完全清空当前所有链接（包括原始链接和自定义链接）
                        const allLinks = section.querySelectorAll('.link-card');
                        console.log(`清除栏目 ${sectionId} 中的 ${allLinks.length} 个现有链接`);
                        allLinks.forEach(link => link.remove());
                        
                        // 重新添加保存状态中的所有链接
                        links.forEach((link, index) => {
                            console.log(`恢复链接 ${index + 1}/${links.length}: ${link.title} (自定义: ${link.isCustom}, 修改: ${link.isModified})`);
                            
                            // 创建链接元素
                            const linkCard = document.createElement('a');
                            linkCard.href = link.url;
                            linkCard.className = 'link-card';
                            linkCard.target = '_blank';
                            linkCard.rel = 'noopener noreferrer';
                            
                            // 标记链接类型
                            if (link.isCustom) {
                                linkCard.setAttribute('data-custom', 'true');
                            }
                            if (link.isModified) {
                                linkCard.setAttribute('data-modified', 'true');
                            }
                            
                            // 设置链接内容
                            linkCard.innerHTML = `
                                <i class="${link.icon}"></i>
                                <div class="link-content">
                                    <div class="link-title">${link.title}</div>
                                    <div class="link-url">${new URL(link.url).hostname}</div>
                                </div>
                            `;
                            
                            section.appendChild(linkCard);
                        });
                        
                        console.log(`栏目 ${sectionId} 恢复完成，当前链接数: ${section.querySelectorAll('.link-card').length}`);
                    }
                });
                
                console.log('完整链接状态恢复完成');
                
                // 更新快捷键分配
                refreshShortcuts();
            }

            // 恢复内置栏目的新增链接（向后兼容）
            restoreBuiltInAdditions(builtInAdditions) {
                Object.keys(builtInAdditions).forEach(sectionId => {
                    const links = builtInAdditions[sectionId];
                    links.forEach(link => {
                        this.addLinkToBuiltInSection(sectionId, link.title, link.url, link.icon.replace(' link-icon', ''), false);
                    });
                });
            }

            // 应用栏目顺序
            applySectionOrder(sectionOrder) {
                const container = document.querySelector('.container');
                
                sectionOrder.forEach(sectionId => {
                    const section = document.querySelector(`[data-section-id="${sectionId}"]`);
                    if (section) {
                        container.appendChild(section);
                    }
                });
            }

            // 显示用户菜单
            showUserMenu() {
                const menu = confirm(`已连接到GitHub账户: ${this.githubStorage.username}\n\n点击"确定"断开连接，点击"取消"继续使用`);
                if (menu) {
                    this.githubStorage.disconnect();
                    this.updateAuthButton();
                    showNotification('已断开GitHub连接', 'success');
                }
            }
        }

        // 全局变量
        let linksManager;

        // 测试GitHub同步的辅助函数
        async function testGitHubSync() {
            console.log('=== 测试GitHub同步 ===');
            
            if (!linksManager) {
                console.error('linksManager未初始化');
                return;
            }
            
            if (!linksManager.githubStorage.isConnected()) {
                console.error('GitHub未连接');
                return;
            }
            
            console.log('开始测试保存...');
            try {
                const testConfig = {
                    test: true,
                    timestamp: new Date().toISOString(),
                    message: '这是一个测试配置'
                };
                
                const result = await linksManager.githubStorage.saveConfig(testConfig);
                console.log('测试保存成功！', result);
                showNotification('测试保存成功！请检查Console查看详情', 'success');
                
                // 测试加载
                console.log('开始测试加载...');
                const loadedConfig = await linksManager.githubStorage.loadConfig();
                console.log('测试加载成功！', loadedConfig);
                
            } catch (error) {
                console.error('测试失败:', error);
                showNotification('测试失败: ' + error.message, 'error');
            }
        }

        // 测试拖拽功能的辅助函数
        window.testDragAndDrop = function() {
            console.log('=== 测试拖拽功能 ===');
            
            // 强制启用拖拽
            enableDragAndDrop();
            
            // 检查所有元素的拖拽状态
            const sections = document.querySelectorAll('.section');
            const linkCards = document.querySelectorAll('.link-card');
            
            console.log('栏目拖拽状态:');
            sections.forEach((section, index) => {
                console.log(`Section ${index}: draggable=${section.draggable}, id=${section.dataset.sectionId}`);
            });
            
            console.log('链接拖拽状态:');
            linkCards.forEach((card, index) => {
                console.log(`Link ${index}: draggable=${card.draggable}, title=${card.querySelector('.link-title')?.textContent}`);
            });
            
            showNotification('拖拽测试已启用，请查看Console并尝试拖拽', 'success');
        }

        // 测试删除同步功能
        window.testDeleteSync = function() {
            console.log('=== 测试删除同步功能 ===');
            
            if (!linksManager) {
                console.error('linksManager未初始化');
                return;
            }
            
            console.log('GitHub连接状态:', linksManager.githubStorage.isConnected());
            console.log('当前gistId:', linksManager.githubStorage.gistId);
            
            // 获取当前配置
            const config = linksManager.getFullConfig();
            console.log('当前完整配置:', config);
            
            // 测试保存
            console.log('测试保存到GitHub...');
            linksManager.saveToGitHub(true).then(() => {
                console.log('✅ 测试保存成功');
            }).catch(error => {
                console.error('❌ 测试保存失败:', error);
            });
        }

        // 测试快捷键功能
        window.testShortcuts = function() {
            console.log('=== 测试快捷键功能 ===');
            
            // 显示当前快捷键映射
            const shortcutCards = document.querySelectorAll('[data-shortcut]');
            console.log(`当前有 ${shortcutCards.length} 个快捷键：`);
            
            shortcutCards.forEach(card => {
                const key = card.getAttribute('data-shortcut');
                const title = card.querySelector('.link-title')?.textContent || '未知';
                const sectionId = card.closest('.section')?.dataset.sectionId || '未知';
                console.log(`${key} → ${title} (${getSectionName(sectionId)}栏目)`);
            });
            
            // 检查管理模式状态
            const isInManagementMode = linksManager && linksManager.isManagementMode;
            console.log('当前管理模式状态:', isInManagementMode ? '开启' : '关闭');
            console.log('快捷键可用状态:', !isInManagementMode ? '可用' : '禁用（管理模式下）');
            
            // 提示用户测试
            console.log('请按数字键 1-9 测试快捷键功能');
            console.log('注意：在输入框中输入时快捷键会被禁用');
            
            showNotification('快捷键测试信息已输出到Console', 'success');
        }

        // 测试完整拖拽功能
        window.testFullDragAndDrop = function() {
            console.log('=== 测试完整拖拽功能 ===');
            
            if (!linksManager) {
                console.error('linksManager未初始化');
                return;
            }
            
            console.log('当前管理模式状态:', linksManager.isManagementMode ? '开启' : '关闭');
            
            if (!linksManager.isManagementMode) {
                console.log('请先开启管理模式以启用拖拽功能');
                return;
            }
            
            // 检查栏目拖拽状态
            const sections = document.querySelectorAll('.section');
            console.log(`检查 ${sections.length} 个栏目的拖拽状态:`);
            sections.forEach((section, index) => {
                const sectionId = section.dataset.sectionId;
                const draggable = section.draggable;
                console.log(`栏目 ${index} (${sectionId}): draggable=${draggable}`);
            });
            
            // 检查链接拖拽状态
            const linkCards = document.querySelectorAll('.link-card');
            console.log(`检查 ${linkCards.length} 个链接的拖拽状态:`);
            linkCards.forEach((card, index) => {
                const title = card.querySelector('.link-title')?.textContent || '未知';
                const draggable = card.draggable;
                console.log(`链接 ${index} (${title}): draggable=${draggable}`);
            });
            
            // 检查事件监听器
            console.log('拖拽相关全局变量状态:');
            console.log('draggedElement:', draggedElement);
            console.log('draggedLinkElement:', draggedLinkElement);
            console.log('dragType:', dragType);
            
            console.log('=== 拖拽功能测试提示 ===');
            console.log('1. 栏目拖拽：拖拽栏目标题区域来重排序栏目');
            console.log('2. 链接拖拽：拖拽链接卡片来重排序链接或移动到其他栏目');
            console.log('3. 查看Console输出的拖拽开始/结束消息');
            
            showNotification('拖拽功能测试信息已输出到Console', 'success');
        }

        // 测试快捷键GitHub同步功能
        window.testShortcutSync = function() {
            console.log('=== 测试快捷键GitHub同步功能 ===');
            
            if (!linksManager) {
                console.error('linksManager未初始化');
                return;
            }
            
            console.log('GitHub连接状态:', linksManager.githubStorage.isConnected());
            console.log('当前快捷键模式:', shortcutMode);
            console.log('手动快捷键设置:', manualShortcuts);
            
            if (linksManager.githubStorage.isConnected()) {
                console.log('开始测试保存到GitHub...');
                saveShortcutSettingsToGitHub()
                    .then(() => {
                        console.log('✅ 快捷键设置保存到GitHub成功');
                        return linksManager.githubStorage.loadConfig();
                    })
                    .then(config => {
                        console.log('从GitHub加载的完整配置:', config);
                        if (config && config.shortcutSettings) {
                            console.log('✅ 快捷键设置已包含在GitHub配置中:', config.shortcutSettings);
                        } else {
                            console.log('❌ GitHub配置中未找到快捷键设置');
                        }
                    })
                    .catch(error => {
                        console.error('❌ 快捷键同步测试失败:', error);
                    });
            } else {
                console.log('请先连接GitHub账户再测试同步功能');
            }
            
            showNotification('快捷键同步测试已开始，请查看Console', 'info');
        }

        // 快捷键设置相关函数
        function openShortcutSettings() {
            // 初始化设置界面
            loadShortcutSettings();
            document.getElementById('shortcutSettingsModal').style.display = 'flex';
        }

        function closeShortcutSettings() {
            document.getElementById('shortcutSettingsModal').style.display = 'none';
        }

        function loadShortcutSettings() {
            // 设置当前模式
            document.querySelector(`input[name="shortcutMode"][value="${shortcutMode}"]`).checked = true;
            
            // 显示同步状态
            updateShortcutSyncStatus();
            
            // 显示/隐藏手动设置区域
            changeShortcutMode();
        }

        function updateShortcutSyncStatus() {
            const statusElement = document.getElementById('shortcutSyncStatus');
            const isConnected = linksManager && linksManager.githubStorage.isConnected();
            
            if (isConnected) {
                statusElement.className = 'sync-status connected';
                statusElement.innerHTML = `
                    <i class="fas fa-cloud-upload-alt"></i>
                    <span>GitHub同步已启用 - 设置将自动同步到云端</span>
                `;
            } else {
                statusElement.className = 'sync-status disconnected';
                statusElement.innerHTML = `
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>未连接GitHub - 设置仅保存在本地</span>
                `;
            }
        }

        function changeShortcutMode() {
            const selectedMode = document.querySelector('input[name="shortcutMode"]:checked').value;
            const manualSettings = document.getElementById('manualShortcutSettings');
            
            if (selectedMode === 'manual') {
                manualSettings.style.display = 'block';
                generateManualShortcutList();
            } else {
                manualSettings.style.display = 'none';
            }
        }

        function generateManualShortcutList() {
            const shortcutList = document.getElementById('shortcutList');
            shortcutList.innerHTML = '';
            
            // 获取所有可见链接
            const allCards = document.querySelectorAll('.link-card');
            const visibleCards = Array.from(allCards).filter(card => {
                const section = card.closest('.section');
                return section && !section.classList.contains('hidden');
            });
            
            visibleCards.forEach(card => {
                const cardId = getCardId(card);
                const title = card.querySelector('.link-title')?.textContent || '未知';
                const href = card.href || '';
                const currentKey = manualShortcuts[cardId] || '';
                
                const item = document.createElement('div');
                item.className = 'shortcut-item';
                item.innerHTML = `
                    <div class="shortcut-item-info">
                        <div class="shortcut-item-title">${title}</div>
                        <div class="shortcut-item-url">${href}</div>
                    </div>
                    <input type="text" 
                           class="shortcut-key-input" 
                           value="${currentKey}" 
                           placeholder="1-9"
                           maxlength="1"
                           data-card-id="${cardId}"
                           onkeypress="validateShortcutKey(event)"
                           onchange="updateManualShortcut(this)">
                `;
                shortcutList.appendChild(item);
            });
        }

        function validateShortcutKey(event) {
            const key = event.key;
            if (key >= '1' && key <= '9') {
                return true;
            } else if (key === 'Backspace' || key === 'Delete') {
                return true;
            } else {
                event.preventDefault();
                return false;
            }
        }

        function updateManualShortcut(input) {
            const cardId = input.dataset.cardId;
            const value = input.value;
            
            if (value === '' || (value >= '1' && value <= '9')) {
                if (value === '') {
                    delete manualShortcuts[cardId];
                } else {
                    // 检查是否与其他快捷键冲突
                    const existingCardId = Object.keys(manualShortcuts).find(id => 
                        id !== cardId && manualShortcuts[id] === value
                    );
                    
                    if (existingCardId) {
                        // 清除冲突的快捷键
                        delete manualShortcuts[existingCardId];
                        // 重新生成列表以更新显示
                        setTimeout(generateManualShortcutList, 0);
                    }
                    
                    manualShortcuts[cardId] = value;
                }
            } else {
                input.value = manualShortcuts[cardId] || '';
            }
        }

        function saveShortcutSettings() {
            const selectedMode = document.querySelector('input[name="shortcutMode"]:checked').value;
            
            // 保存设置到localStorage
            shortcutMode = selectedMode;
            localStorage.setItem('shortcutMode', shortcutMode);
            localStorage.setItem('manualShortcuts', JSON.stringify(manualShortcuts));
            
            // 更新快捷键
            updateShortcutKeys();
            
            // 如果连接了GitHub，同步到云端
            if (linksManager && linksManager.githubStorage.isConnected()) {
                console.log('同步快捷键设置到GitHub...');
                saveShortcutSettingsToGitHub()
                    .then(() => {
                        console.log('快捷键设置已同步到GitHub');
                        showNotification('快捷键设置已保存并同步到GitHub', 'success');
                    })
                    .catch(error => {
                        console.error('快捷键设置同步失败:', error);
                        showNotification('快捷键设置已保存到本地，但同步失败: ' + error.message, 'warning');
                    });
            } else {
                showNotification('快捷键设置已保存到本地', 'success');
            }
            
            // 关闭模态框
            closeShortcutSettings();
        }

        // 保存快捷键设置到GitHub
        async function saveShortcutSettingsToGitHub() {
            if (!linksManager || !linksManager.githubStorage.isConnected()) {
                throw new Error('GitHub未连接');
            }

            const shortcutConfig = {
                shortcutMode: shortcutMode,
                manualShortcuts: manualShortcuts,
                lastUpdated: new Date().toISOString()
            };

            // 获取当前完整配置
            const fullConfig = linksManager.getFullConfig();
            fullConfig.shortcutSettings = shortcutConfig;

            // 保存到GitHub
            await linksManager.githubStorage.saveConfig(fullConfig);
        }

        // 从GitHub加载快捷键设置
        function loadShortcutSettingsFromGitHub(config) {
            if (config && config.shortcutSettings) {
                console.log('从GitHub加载快捷键设置:', config.shortcutSettings);
                
                shortcutMode = config.shortcutSettings.shortcutMode || 'auto';
                manualShortcuts = config.shortcutSettings.manualShortcuts || {};
                
                // 同步到localStorage
                localStorage.setItem('shortcutMode', shortcutMode);
                localStorage.setItem('manualShortcuts', JSON.stringify(manualShortcuts));
                
                // 更新快捷键
                updateShortcutKeys();
                
                console.log('快捷键设置已从GitHub恢复');
                return true;
            }
            return false;
        }

        // 检查用户权限
        function checkUserPermission() {
            if (!linksManager.githubStorage.isConnected()) {
                showNotification('请先连接GitHub账户', 'error');
                return false;
            }
            return true;
        }

        // 临时测试函数：不检查权限的管理模式切换
        function testToggleManagementMode() {
            console.log('testToggleManagementMode 被调用（跳过权限检查）');
            
            const button = document.getElementById('managementModeToggle');
            const sections = document.querySelectorAll('.section');
            
            linksManager.isManagementMode = !linksManager.isManagementMode;
            
            if (linksManager.isManagementMode) {
                button.classList.add('active');
                button.innerHTML = '<i class="fas fa-times"></i> 退出管理';
                sections.forEach(section => section.classList.add('editing'));
                
                // 强制启用拖拽功能
                console.log('强制启用拖拽功能');
                enableDragAndDrop();
                
                // 验证拖拽是否启用
                const firstSection = document.querySelector('.section');
                console.log('第一个section的draggable属性:', firstSection?.draggable);
                console.log('sections总数:', sections.length);
                
                disableAllLinks();
                console.log('进入管理模式（测试）');
            } else {
                button.classList.remove('active');
                button.innerHTML = '<i class="fas fa-cog"></i> 管理模式';
                sections.forEach(section => {
                    section.classList.remove('editing');
                    section.querySelectorAll('.link-card').forEach(card => card.classList.remove('editing'));
                });
                disableDragAndDrop();
                enableAllLinks();
                console.log('退出管理模式（测试）');
            }
        }

        // 管理模式相关函数
        function toggleManagementMode() {
            console.log('toggleManagementMode 被调用');
            console.log('linksManager:', linksManager);
            console.log('linksManager.githubStorage.isConnected():', linksManager?.githubStorage?.isConnected());
            
            if (!checkUserPermission()) {
                console.log('用户权限检查失败');
                return;
            }
            
            const button = document.getElementById('managementModeToggle');
            const sections = document.querySelectorAll('.section');
            
            console.log('当前管理模式状态:', linksManager.isManagementMode);
            linksManager.isManagementMode = !linksManager.isManagementMode;
            console.log('切换后管理模式状态:', linksManager.isManagementMode);
            
            if (linksManager.isManagementMode) {
                button.classList.add('active');
                button.innerHTML = '<i class="fas fa-times"></i> 退出管理';
                sections.forEach(section => section.classList.add('editing'));
                enableDragAndDrop();
                disableAllLinks();
                console.log('进入管理模式');
            } else {
                button.classList.remove('active');
                button.innerHTML = '<i class="fas fa-cog"></i> 管理模式';
                sections.forEach(section => {
                    section.classList.remove('editing');
                    section.querySelectorAll('.link-card').forEach(card => card.classList.remove('editing'));
                });
                disableDragAndDrop();
                enableAllLinks();
                console.log('退出管理模式');
            }
        }

        function toggleSectionVisibility(sectionId) {
            console.log('切换栏目显示状态:', sectionId);
            
            const section = document.querySelector(`[data-section-id="${sectionId}"]`);
            const button = section.querySelector('.visibility-toggle i');
            
            if (!linksManager) {
                console.error('linksManager未初始化');
                return;
            }
            
            const isCurrentlyHidden = linksManager.hiddenSections.has(sectionId);
            
            if (isCurrentlyHidden) {
                // 显示栏目
                linksManager.hiddenSections.delete(sectionId);
                section.classList.remove('hidden');
                button.className = 'fas fa-eye';
                showNotification(`已显示"${getSectionName(sectionId)}"栏目`, 'success');
                console.log('栏目已显示:', sectionId);
            } else {
                // 隐藏栏目
                linksManager.hiddenSections.add(sectionId);
                section.classList.add('hidden');
                button.className = 'fas fa-eye-slash';
                showNotification(`已隐藏"${getSectionName(sectionId)}"栏目`, 'success');
                console.log('栏目已隐藏:', sectionId);
            }
            
            // 只有在GitHub连接时才保存到云端
            if (linksManager.githubStorage.isConnected()) {
                linksManager.saveToGitHub(false);
                console.log('栏目状态已同步到GitHub');
            } else {
                console.log('GitHub未连接，栏目状态仅保存在本地');
            }
            
            // 更新快捷键分配
            refreshShortcuts();
        }

        // 获取栏目中文名称
        function getSectionName(sectionId) {
            const names = {
                'school': '学校',
                'research': '科研', 
                'personal': '个人',
                'links': '链接'
            };
            return names[sectionId] || sectionId;
        }

        // 快捷键设置相关变量
        let shortcutMode = localStorage.getItem('shortcutMode') || 'auto';
        let manualShortcuts = JSON.parse(localStorage.getItem('manualShortcuts') || '{}');

        // 动态更新快捷键分配
        function updateShortcutKeys() {
            console.log('更新快捷键分配...', '模式:', shortcutMode);
            
            // 清除所有现有的快捷键标记
            document.querySelectorAll('[data-shortcut]').forEach(card => {
                card.removeAttribute('data-shortcut');
                const hint = card.querySelector('.shortcut-hint');
                if (hint) hint.remove();
            });
            
            // 如果快捷键被禁用，直接返回
            if (shortcutMode === 'disabled') {
                console.log('快捷键已禁用');
                return;
            }
            
            // 获取所有可见的链接卡片（按DOM顺序）
            const allCards = document.querySelectorAll('.link-card');
            const visibleCards = Array.from(allCards).filter(card => {
                const section = card.closest('.section');
                return section && !section.classList.contains('hidden');
            });
            
            console.log(`找到 ${visibleCards.length} 个可见链接`);
            
            if (shortcutMode === 'auto') {
                // 自动分配模式：为前9个可见链接分配快捷键
                visibleCards.slice(0, 9).forEach((card, index) => {
                    const shortcutKey = (index + 1).toString();
                    assignShortcutToCard(card, shortcutKey);
                });
            } else if (shortcutMode === 'manual') {
                // 手动设置模式：根据用户配置分配
                visibleCards.forEach(card => {
                    const cardId = getCardId(card);
                    if (manualShortcuts[cardId] && manualShortcuts[cardId] >= '1' && manualShortcuts[cardId] <= '9') {
                        assignShortcutToCard(card, manualShortcuts[cardId]);
                    }
                });
            }
            
            console.log('快捷键分配完成');
        }

        // 为卡片分配快捷键
        function assignShortcutToCard(card, shortcutKey) {
            card.setAttribute('data-shortcut', shortcutKey);
            
            // 添加快捷键提示
            if (!card.querySelector('.shortcut-hint')) {
                const hint = document.createElement('div');
                hint.className = 'shortcut-hint';
                hint.textContent = shortcutKey;
                card.appendChild(hint);
            }
            
            const title = card.querySelector('.link-title')?.textContent || '未知';
            console.log(`快捷键 ${shortcutKey} → ${title}`);
        }

        // 获取卡片的唯一ID
        function getCardId(card) {
            const title = card.querySelector('.link-title')?.textContent || '';
            const href = card.href || '';
            return `${title}-${href}`.replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g, '_');
        }

        // 动态调整搜索组件位置
        function updateSearchGroupPosition() {
            const searchGroup = document.querySelector('.search-group');
            const managementButton = document.getElementById('managementModeToggle');
            
            if (searchGroup && managementButton) {
                const isManagementVisible = managementButton.style.display !== 'none';
                
                if (isManagementVisible) {
                    searchGroup.classList.add('with-management-mode');
                } else {
                    searchGroup.classList.remove('with-management-mode');
                }
                
                console.log('搜索组件位置已更新，管理模式可见:', isManagementVisible);
            }
        }

        // 返回主页功能
        function returnToHomepage() {
            console.log('返回主页');
            window.location.href = 'https://tanlizhuang.cn/index_cn.html';
        }

        // 在链接状态改变时调用此函数更新快捷键
        function refreshShortcuts() {
            // 延迟执行，确保DOM更新完成
            setTimeout(updateShortcutKeys, 100);
        }

        function toggleSectionEdit(sectionId) {
            if (!checkUserPermission()) return;
            
            const section = document.querySelector(`[data-section-id="${sectionId}"]`);
            const linkCards = section.querySelectorAll('.link-card');
            
            linkCards.forEach(card => {
                if (card.classList.contains('editing')) {
                    card.classList.remove('editing');
                } else {
                    card.classList.add('editing');
                    addLinkEditControls(card, sectionId);
                }
            });
        }

        function addLinkEditControls(linkCard, sectionId) {
            if (linkCard.querySelector('.link-edit-controls')) return;
            
            const controls = document.createElement('div');
            controls.className = 'link-edit-controls';
            controls.innerHTML = `
                <button class="link-edit-btn edit" onclick="editLink('${sectionId}', this, event)" title="编辑">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="link-edit-btn delete" onclick="deleteLink('${sectionId}', this, event)" title="删除">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            linkCard.appendChild(controls);
        }

        function editLink(sectionId, button, event) {
            if (!checkUserPermission()) return;
            
            // 阻止事件冒泡，避免触发链接跳转
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            const linkCard = button.closest('.link-card');
            const title = linkCard.querySelector('.link-title').textContent;
            const url = linkCard.href;
            const icon = linkCard.querySelector('.link-icon').className;
            
            document.getElementById('editSectionId').value = sectionId;
            document.getElementById('editLinkId').value = Array.from(linkCard.parentElement.children).indexOf(linkCard);
            document.getElementById('editLinkTitle').value = title;
            document.getElementById('editLinkUrl').value = url;
            document.getElementById('editLinkIcon').value = icon;
            
            document.getElementById('editLinkModal').style.display = 'flex';
        }

        function deleteLink(sectionId, button, event) {
            console.log('=== deleteLink 被调用 ===');
            console.log('sectionId:', sectionId);
            console.log('权限检查开始...');
            
            if (!checkUserPermission()) {
                console.log('权限检查失败，退出删除操作');
                return;
            }
            
            console.log('权限检查通过');
            
            // 阻止事件冒泡，避免触发链接跳转
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            const linkCard = button.closest('.link-card');
            const linkTitle = linkCard.querySelector('.link-title').textContent;
            console.log('准备删除链接:', linkTitle);
            
            if (confirm('确定要删除这个链接吗？')) {
                console.log('用户确认删除，开始执行...');
                linkCard.remove();
                console.log('链接已从DOM中移除');
                
                showNotification('链接已删除并已同步', 'success');
                
                console.log('开始保存到GitHub...');
                linksManager.saveToGitHub(true).then(() => {
                    console.log('删除操作已同步到GitHub');
                }).catch(error => {
                    console.error('同步到GitHub失败:', error);
                    showNotification('同步失败: ' + error.message, 'error');
                });
                
                // 更新快捷键分配
                refreshShortcuts();
            } else {
                console.log('用户取消删除操作');
            }
        }

        function updateLink(event) {
            event.preventDefault();
            if (!checkUserPermission()) return;
            
            const sectionId = document.getElementById('editSectionId').value;
            const linkIndex = parseInt(document.getElementById('editLinkId').value);
            const title = document.getElementById('editLinkTitle').value;
            const url = document.getElementById('editLinkUrl').value;
            const icon = document.getElementById('editLinkIcon').value;
            
            const section = document.querySelector(`[data-section-id="${sectionId}"]`);
            const linkCard = section.querySelectorAll('.link-card')[linkIndex];
            
            if (linkCard) {
                // 更新链接属性
                linkCard.href = url;
                linkCard.querySelector('.link-title').textContent = title;
                linkCard.querySelector('.link-url').textContent = new URL(url).hostname;
                linkCard.querySelector('.link-icon').className = icon + ' link-icon';
                
                // 标记为已修改（如果不是已有的自定义链接）
                if (!linkCard.hasAttribute('data-custom')) {
                    linkCard.setAttribute('data-modified', 'true');
                }
                
                console.log('链接已更新:', {
                    sectionId,
                    linkIndex,
                    title,
                    url,
                    isCustom: linkCard.hasAttribute('data-custom'),
                    isModified: linkCard.hasAttribute('data-modified')
                });
                
                closeModal('editLinkModal');
                showNotification('链接已更新并已同步', 'success');
                linksManager.saveToGitHub(true);
            }
        }

        function enableDragAndDrop() {
            console.log('enableDragAndDrop 被调用');
            
            // 启用栏目拖拽
            const sections = document.querySelectorAll('.section');
            console.log('找到的sections数量:', sections.length);
            
            sections.forEach((section, index) => {
                section.draggable = true;
                section.addEventListener('dragstart', handleSectionDragStart);
                section.addEventListener('dragover', handleSectionDragOver);
                section.addEventListener('dragleave', handleSectionDragLeave);
                section.addEventListener('drop', handleSectionDrop);
                section.addEventListener('dragend', handleSectionDragEnd);
                console.log(`Section ${index} 拖拽已启用, draggable:`, section.draggable);
            });
            
            // 启用链接拖拽
            console.log('启用链接拖拽');
            enableLinkDragAndDrop();
        }

        function disableDragAndDrop() {
            // 禁用栏目拖拽
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => {
                section.draggable = false;
                section.removeEventListener('dragstart', handleSectionDragStart);
                section.removeEventListener('dragover', handleSectionDragOver);
                section.removeEventListener('dragleave', handleSectionDragLeave);
                section.removeEventListener('drop', handleSectionDrop);
                section.removeEventListener('dragend', handleSectionDragEnd);
            });
            
            // 禁用链接拖拽
            disableLinkDragAndDrop();
        }

        function disableAllLinks() {
            const linkCards = document.querySelectorAll('.link-card');
            linkCards.forEach(card => {
                card.addEventListener('click', preventLinkClick);
            });
        }

        function enableAllLinks() {
            const linkCards = document.querySelectorAll('.link-card');
            linkCards.forEach(card => {
                card.removeEventListener('click', preventLinkClick);
            });
        }

        function preventLinkClick(event) {
            event.preventDefault();
            event.stopPropagation();
        }

        // 链接拖拽功能
        function enableLinkDragAndDrop() {
            console.log('enableLinkDragAndDrop 被调用');
            const linkCards = document.querySelectorAll('.link-card');
            console.log('找到的链接卡片数量:', linkCards.length);
            
            linkCards.forEach((card, index) => {
                card.draggable = true;
                card.addEventListener('dragstart', handleLinkDragStart);
                card.addEventListener('dragover', handleLinkDragOver);
                card.addEventListener('dragleave', handleLinkDragLeave);
                card.addEventListener('drop', handleLinkDrop);
                card.addEventListener('dragend', handleLinkDragEnd);
                console.log(`Link ${index} 拖拽已启用, draggable:`, card.draggable);
            });
        }

        function disableLinkDragAndDrop() {
            const linkCards = document.querySelectorAll('.link-card');
            linkCards.forEach(card => {
                card.draggable = false;
                card.removeEventListener('dragstart', handleLinkDragStart);
                card.removeEventListener('dragover', handleLinkDragOver);
                card.removeEventListener('dragleave', handleLinkDragLeave);
                card.removeEventListener('drop', handleLinkDrop);
                card.removeEventListener('dragend', handleLinkDragEnd);
            });
        }

        let draggedElement = null;
        let draggedLinkElement = null;
        let dragType = null; // 跟踪拖拽类型

        // 栏目拖拽处理函数
        function handleSectionDragStart(e) {
            console.log('栏目拖拽开始:', this);
            draggedElement = this;
            dragType = 'section';
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', 'section'); // 设置数据用于识别
            console.log('栏目拖拽数据已设置');
        }

        function handleSectionDragOver(e) {
            // 只处理栏目拖拽
            if (dragType === 'section' && draggedElement) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                
                if (this !== draggedElement) {
                    // 清除其他section的drag-over样式
                    document.querySelectorAll('.section').forEach(section => {
                        if (section !== this) section.classList.remove('drag-over');
                    });
                    this.classList.add('drag-over');
                }
            }
        }

        function handleSectionDragLeave(e) {
            // 只有当真正离开元素时才移除样式
            if (dragType === 'section' && !this.contains(e.relatedTarget)) {
                this.classList.remove('drag-over');
            }
        }

        function handleSectionDrop(e) {
            if (dragType === 'section' && draggedElement) {
                e.preventDefault();
                e.stopPropagation();
                this.classList.remove('drag-over');
                
                if (this !== draggedElement) {
                    const container = document.querySelector('.container');
                    console.log('执行栏目重排序...');
                    
                    // 获取所有栏目的当前位置
                    const targetIndex = Array.from(container.children).indexOf(this);
                    const draggedIndex = Array.from(container.children).indexOf(draggedElement);
                    
                    console.log(`从位置 ${draggedIndex} 移动到位置 ${targetIndex}`);
                    
                    // 执行移动
                    if (targetIndex > draggedIndex) {
                        // 向下移动：插入到目标元素之后
                        container.insertBefore(draggedElement, this.nextSibling);
                    } else {
                        // 向上移动：插入到目标元素之前
                        container.insertBefore(draggedElement, this);
                    }
                    
                    showNotification('栏目顺序已更新', 'success');
                    linksManager.saveToGitHub(false);
                    refreshShortcuts(); // 更新快捷键
                }
            }
        }

        function handleSectionDragEnd(e) {
            console.log('栏目拖拽结束');
            this.classList.remove('dragging');
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('drag-over');
            });
            draggedElement = null;
            dragType = null;
        }

        // 链接拖拽处理函数
        function handleLinkDragStart(e) {
            console.log('链接拖拽开始:', this);
            draggedLinkElement = this;
            dragType = 'link';
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', 'link');
            e.stopPropagation(); // 防止触发栏目拖拽
            console.log('链接拖拽数据已设置');
        }

        function handleLinkDragOver(e) {
            // 只处理链接拖拽
            if (dragType === 'link' && draggedLinkElement && this.classList.contains('link-card')) {
                e.preventDefault();
                e.stopPropagation();
                e.dataTransfer.dropEffect = 'move';
                
                if (this !== draggedLinkElement) {
                    // 清除其他链接的drag-over样式
                    document.querySelectorAll('.link-card').forEach(card => {
                        if (card !== this) card.classList.remove('drag-over');
                    });
                    this.classList.add('drag-over');
                }
            }
        }

        function handleLinkDragLeave(e) {
            // 只有当真正离开元素时才移除样式
            if (dragType === 'link' && this.classList.contains('link-card') && !this.contains(e.relatedTarget)) {
                this.classList.remove('drag-over');
            }
        }

        function handleLinkDrop(e) {
            if (dragType === 'link' && draggedLinkElement && this.classList.contains('link-card')) {
                e.preventDefault();
                e.stopPropagation();
                this.classList.remove('drag-over');
                
                if (this !== draggedLinkElement) {
                    const sourceGrid = draggedLinkElement.parentElement;
                    const targetGrid = this.parentElement;
                    console.log('执行链接重排序...');
                    
                    // 获取链接的当前位置
                    const targetCards = Array.from(targetGrid.children);
                    const draggedIndex = Array.from(sourceGrid.children).indexOf(draggedLinkElement);
                    const targetIndex = targetCards.indexOf(this);
                    
                    console.log(`从位置 ${draggedIndex} 移动到位置 ${targetIndex}`);
                    
                    // 执行移动
                    if (sourceGrid === targetGrid) {
                        // 同一栏目内重排序
                        if (targetIndex > draggedIndex) {
                            // 向下移动：插入到目标元素之后
                            targetGrid.insertBefore(draggedLinkElement, this.nextSibling);
                        } else {
                            // 向上移动：插入到目标元素之前
                            targetGrid.insertBefore(draggedLinkElement, this);
                        }
                    } else {
                        // 跨栏目移动：插入到目标元素之前
                        targetGrid.insertBefore(draggedLinkElement, this);
                    }
                    
                    showNotification('链接顺序已更新', 'success');
                    linksManager.saveToGitHub(false);
                    refreshShortcuts(); // 更新快捷键
                }
            }
        }

        function handleLinkDragEnd(e) {
            console.log('链接拖拽结束');
            this.classList.remove('dragging');
            document.querySelectorAll('.link-card').forEach(card => {
                card.classList.remove('drag-over');
            });
            draggedLinkElement = null;
            dragType = null;
        }

        // UI交互函数
        function openGitHubAuthModal() {
            document.getElementById('githubAuthModal').style.display = 'flex';
        }



        function openAddLinkModal(sectionId) {
            if (!checkUserPermission()) return;
            
            // 如果是内置栏目，则添加到内置栏目；如果是数字ID，则是自定义栏目
            document.getElementById('targetSectionId').value = sectionId;
            document.getElementById('addLinkModal').style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            // 清空表单
            const form = document.querySelector(`#${modalId} form`);
            if (form) form.reset();
        }

        // GitHub认证设置
        async function setupGitHubAuth() {
            const token = document.getElementById('githubToken').value.trim();
            if (!token) {
                showNotification('请输入GitHub Token', 'error');
                return;
            }

            try {
                const success = await linksManager.githubStorage.setToken(token);
                if (success) {
                    linksManager.updateAuthButton();
                    closeModal('githubAuthModal');
                    showNotification('GitHub连接成功！', 'success');
                    
                    // 连接成功后加载配置
                    console.log('GitHub连接成功，开始加载配置...'); // 调试日志
                    console.log('当前gistId:', linksManager.githubStorage.gistId); // 调试日志
                    await linksManager.loadFromGitHub();
                } else {
                    showNotification('Token验证失败，请检查后重试', 'error');
                }
            } catch (error) {
                showNotification('连接失败: ' + error.message, 'error');
            }
        }



        // 添加自定义链接
        function addCustomLink(event) {
            event.preventDefault();
            if (!checkUserPermission()) return;
            
            const sectionId = document.getElementById('targetSectionId').value;
            const title = document.getElementById('linkTitle').value.trim();
            const url = document.getElementById('linkUrl').value.trim();
            const icon = document.getElementById('linkIcon').value.trim();
            
            if (!title || !url) {
                showNotification('请填写完整信息', 'error');
                return;
            }

            linksManager.addLinkToSection(sectionId, title, url, icon);
            closeModal('addLinkModal');
            showNotification(`链接"${title}"添加成功并已同步`, 'success');
        }

        // 全局通知管理
        let notificationTimeout = null;

        // 显示通知
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            
            // 清除之前的定时器
            if (notificationTimeout) {
                clearTimeout(notificationTimeout);
                notificationTimeout = null;
            }
            
            // 先隐藏当前通知（如果有）
            notification.classList.remove('show');
            
            // 短暂延迟后显示新通知
            setTimeout(() => {
                notification.textContent = message;
                notification.className = `notification ${type}`;
                notification.classList.add('show');
                
                // 添加点击关闭功能
                notification.onclick = () => {
                    hideNotification();
                };
                
                // 设置3秒后自动隐藏
                notificationTimeout = setTimeout(() => {
                    hideNotification();
                }, 3000);
            }, 50);
        }

        // 隐藏通知
        function hideNotification() {
            const notification = document.getElementById('notification');
            notification.classList.remove('show');
            notification.onclick = null;
            
            if (notificationTimeout) {
                clearTimeout(notificationTimeout);
                notificationTimeout = null;
            }
        }

        // 搜索功能
        function searchLinks() {
            const searchInput = document.querySelector('.search-box');
            const searchTerm = searchInput.value.toLowerCase().trim();
            const linkCards = document.querySelectorAll('.link-card');
            
            linkCards.forEach(card => {
                const title = card.querySelector('.link-title').textContent;
                const url = card.querySelector('.link-url').textContent.toLowerCase();
                
                let shouldShow = false;
                
                if (searchTerm === '') {
                    shouldShow = true;
                } else {
                    // 直接文本匹配
                    if (title.toLowerCase().includes(searchTerm) || url.includes(searchTerm)) {
                        shouldShow = true;
                    } else {
                        // 拼音模糊搜索
                        for (const [chinese, pinyins] of Object.entries(pinyinMap)) {
                            if (title.includes(chinese)) {
                                for (const pinyin of pinyins) {
                                    if (pinyin.includes(searchTerm) || searchTerm.includes(pinyin)) {
                                        shouldShow = true;
                                        break;
                                    }
                                }
                                if (shouldShow) break;
                            }
                        }
                        
                        // 英文缩写匹配
                        if (!shouldShow) {
                            const titleParts = title.split('');
                            let acronym = '';
                            titleParts.forEach(char => {
                                if (pinyinMap[char]) {
                                    acronym += pinyinMap[char][1] || pinyinMap[char][0].charAt(0);
                                } else if (/[a-zA-Z]/.test(char)) {
                                    acronym += char.toLowerCase();
                                }
                            });
                            if (acronym.includes(searchTerm)) {
                                shouldShow = true;
                            }
                        }
                        
                        // 部分匹配
                        if (!shouldShow) {
                            const keywords = searchTerm.split('');
                            let matchCount = 0;
                            keywords.forEach(keyword => {
                                if (title.toLowerCase().includes(keyword) || url.includes(keyword)) {
                                    matchCount++;
                                }
                            });
                            if (matchCount >= Math.min(2, keywords.length)) {
                                shouldShow = true;
                            }
                        }
                    }
                }
                
                card.style.display = shouldShow ? 'flex' : 'none';
            });
            
            // 隐藏空的栏目
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => {
                const visibleCards = section.querySelectorAll('.link-card[style*="flex"]');
                const allCards = section.querySelectorAll('.link-card');
                
                if (searchTerm === '') {
                    section.style.display = 'flex';
                    allCards.forEach(card => card.style.display = 'flex');
                } else {
                    section.style.display = visibleCards.length > 0 ? 'flex' : 'none';
                }
            });
        }



        // 快捷键支持
        document.addEventListener('keydown', function(e) {
            // 检查是否在输入框中，如果是则不触发快捷键
            const activeElement = document.activeElement;
            const isInInput = activeElement && (
                activeElement.tagName === 'INPUT' || 
                activeElement.tagName === 'TEXTAREA' || 
                activeElement.contentEditable === 'true'
            );
            
            // 检查是否在管理模式下
            const isInManagementMode = linksManager && linksManager.isManagementMode;
            
            // 数字键快捷键（只在非输入状态且非管理模式下生效）
            if (e.key >= '1' && e.key <= '9' && !isInInput && !isInManagementMode) {
                const targetCard = document.querySelector(`[data-shortcut="${e.key}"]`);
                if (targetCard) {
                    console.log(`快捷键 ${e.key} 触发:`, targetCard.querySelector('.link-title')?.textContent);
                    targetCard.click();
                }
            }
            
            // ESC键清空搜索（在任何状态下都可用）
            if (e.key === 'Escape') {
                const searchBox = document.querySelector('.search-box');
                if (searchBox.value) {
                    searchBox.value = '';
                    searchLinks();
                } else if (activeElement && isInInput) {
                    // 如果搜索框为空且当前在其他输入框中，则取消焦点
                    activeElement.blur();
                }
            }
            
            // Ctrl+K 聚焦搜索框（在任何状态下都可用）
            if (e.ctrlKey && e.key === 'k') {
                e.preventDefault();
                document.querySelector('.search-box').focus();
            }
        });

        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 为所有原始链接添加索引标记
            document.querySelectorAll('.section').forEach(section => {
                const sectionId = section.dataset.sectionId;
                if (sectionId) {
                    const linkCards = section.querySelectorAll('.link-card');
                    linkCards.forEach((card, index) => {
                        if (!card.hasAttribute('data-custom')) {
                            card.setAttribute('data-original-index', index.toString());
                        }
                    });
                }
            });
            
            // 初始化高级链接管理器
            linksManager = new AdvancedLinksManager();
            
            // 平滑滚动和交互效果
            const cards = document.querySelectorAll('.link-card');
            
            cards.forEach((card, index) => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-2px) scale(1.01)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0) scale(1)';
            });
        });

            // 初始化快捷键设置
            shortcutMode = localStorage.getItem('shortcutMode') || 'auto';
            manualShortcuts = JSON.parse(localStorage.getItem('manualShortcuts') || '{}');
            
            // 初始化快捷键分配
            setTimeout(updateShortcutKeys, 500); // 延迟执行，确保linksManager已完全初始化
            
            // 初始化搜索组件位置
            setTimeout(updateSearchGroupPosition, 600); // 在linksManager初始化后调用

            // 点击模态框背景关闭
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.style.display = 'none';
                    }
                });
            });
        });
    </script>
</body>
</html>